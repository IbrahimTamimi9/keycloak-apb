FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogSWRlbnRpdHkgTWFu\
YWdlbWVudCAtIElkZW50aXR5IGFuZCBBY2Nlc3MgTWFuYWdlbWVudApiaW5kYWJsZTogVHJ1ZQph\
c3luYzogcmVxdWlyZWQKdGFnczogCiAgLSBtb2JpbGUtc2VydmljZQogIC0gbW9iaWxlLWNsaWVu\
dC1lbmFibGVkCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBJZGVudGl0eSBNYW5hZ2VtZW50CiAg\
aW1hZ2VVcmw6ICJodHRwczovL3Bicy50d2ltZy5jb20vcHJvZmlsZV9pbWFnZXMvNzAyMTE5ODIx\
OTc5MzQ0ODk3L29BQzA1Y0VCXzQwMHg0MDAucG5nIgogIGRvY3VtZW50YXRpb25Vcmw6ICJodHRw\
Oi8vd3d3LmtleWNsb2FrLm9yZy9kb2N1bWVudGF0aW9uLmh0bWwiCiAgcHJvdmlkZXJEaXNwbGF5\
TmFtZTogIlJlZCBIYXQsIEluYy4iCiAgZGVwZW5kZW5jaWVzOgogICAgLSAiZG9ja2VyLmlvL2pi\
b3NzL2tleWNsb2FrLW9wZW5zaGlmdDozLjQuMy5GaW5hbCIKICAgIC0gImRvY2tlci5pby9jZW50\
b3MvcG9zdGdyZXNxbC05Ni1jZW50b3M3OjkuNiIKICBzZGstZG9jcy1hbmRyb2lkOiAiaHR0cHM6\
Ly9kb2NzLmFlcm9nZWFyLm9yZy9hbmRyb2lkLXNkay9sYXRlc3QvZ2V0dGluZy1zdGFydGVkL2F1\
dGguaHRtbCIKICBzZGstZG9jcy1jb3Jkb3ZhOiAiaHR0cHM6Ly9naXRodWIuY29tL2Flcm9nZWFy\
L2Flcm9nZWFyLWFuZHJvaWQtc2RrL2Jsb2IvbWFzdGVyL2RvY3MvbW9kdWxlcy9ST09UL3BhZ2Vz\
L2F1dGguYWRvYyIKICBzZGstZG9jcy1pb3M6ICJodHRwczovL2dpdGh1Yi5jb20vYWVyb2dlYXIv\
YWVyb2dlYXItYW5kcm9pZC1zZGsvYmxvYi9tYXN0ZXIvZG9jcy9tb2R1bGVzL1JPT1QvcGFnZXMv\
YXV0aC5hZG9jIgogIHNkay1kb2NzLXhhbWFyaW46ICJodHRwczovL2dpdGh1Yi5jb20vYWVyb2dl\
YXIvYWVyb2dlYXItYW5kcm9pZC1zZGsvYmxvYi9tYXN0ZXIvZG9jcy9tb2R1bGVzL1JPT1QvcGFn\
ZXMvYXV0aC5hZG9jIgogIHNlcnZpY2VOYW1lOiBrZXljbG9hawpwbGFuczoKICAtIG5hbWU6IGRl\
ZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3kga2V5Y2xvYWsKICAgIGZyZWU6IFRydWUKICAg\
IG1ldGFkYXRhOgogICAgICBtb2JpbGVjbGllbnRfYmluZF9wYXJhbWV0ZXJzX2RhdGE6CiAgICAg\
ICAgLSAneyJuYW1lIjogIkNMSUVOVF9JRCIsICJ2YWx1ZSI6ICJtZXRhZGF0YS5uYW1lIiwgInR5\
cGUiOiAicGF0aCJ9JwogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRfVFlQRSIsICJ2YWx1ZSI6\
ICJwdWJsaWMiLCAidHlwZSI6ICJkZWZhdWx0In0nCiAgICAgIHNlcnZpY2VpbnN0YW5jZV9iaW5k\
X3BhcmFtZXRlcnNfZGF0YToKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX0lEIiwgInZhbHVl\
IjogIm1ldGFkYXRhLm5hbWUiLCAidHlwZSI6ICJwYXRoIn0nCiAgICAgICAgLSAneyJuYW1lIjog\
IkNMSUVOVF9UWVBFIiwgInZhbHVlIjogImJlYXJlciIsICJ0eXBlIjogImRlZmF1bHQifScKICAg\
IHBhcmFtZXRlcnM6IAogICAgLSBuYW1lOiBBRE1JTl9VU0VSTkFNRQogICAgICByZXF1aXJlZDog\
VHJ1ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6\
IEtleWNsb2FrIGFkbWluIHVzZXJuYW1lCiAgICAtIG5hbWU6IEFETUlOX1BBU1NXT1JECiAgICAg\
IHJlcXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICB0aXRsZTogS2V5Y2xvYWsgYWRtaW4gcGFzc3dvcmQKICAgIC0gbmFtZTogQ1VTVE9NX1JF\
QUxNX05BTUUKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0\
aXRsZTogTmFtZSBvZiB0aGUgS2V5Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRvIGN1cnJlbnQgbmFt\
ZXNwYWNlKQogICAgLSBuYW1lOiBVU0VfU0hBUkVEX1NFUlZJQ0UKICAgICAgcmVxdWlyZWQ6IEZh\
bHNlCiAgICAgIHR5cGU6IGJvb2wKICAgICAgdGl0bGU6IENvbm5lY3QgdG8gYW4gZXhpc3Rpbmcg\
c2hhcmVkIHNlcnZpY2UKICAgIC0gbmFtZTogU0hBUkVEX0hPU1QKICAgICAgcmVxdWlyZWQ6IEZh\
bHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVVJMIG9mIHRoZSBzaGFyZWQgc2Vy\
dmljZQogICAgYmluZF9wYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBDTElFTlRfSUQKICAgICAgcmVx\
dWlyZWQ6IFRydWUKICAgICAgdGl0bGU6IE1vYmlsZSBjbGllbnQgSUQvU2VydmljZSBJRAogICAg\
ICB0eXBlOiBzdHJpbmcKICAgIC0gbmFtZTogQ0xJRU5UX1RZUEUKICAgICAgcmVxdWlyZWQ6IFRy\
dWUKICAgICAgdGl0bGU6IEtleWNsb2FrIGNsaWVudCB0eXBlCiAgICAgIHR5cGU6IGVudW0KICAg\
ICAgZW51bTogWydiZWFyZXInLCAncHVibGljJ10KICAgICAgZGVmYXVsdDogcHVibGljCg=="


COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb