FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBP\
cGVuIFNvdXJjZSBJZGVudGl0eSBhbmQgQWNjZXNzIE1hbmFnZW1lbnQKYmluZGFibGU6IFRydWUK\
YXN5bmM6IG9wdGlvbmFsCnRhZ3M6IAogIC0gbW9iaWxlLXNlcnZpY2UKbWV0YWRhdGE6CiAgZGlz\
cGxheU5hbWU6IEtleWNsb2FrCiAgaW1hZ2VVcmw6ICJodHRwczovL3Bicy50d2ltZy5jb20vcHJv\
ZmlsZV9pbWFnZXMvNzAyMTE5ODIxOTc5MzQ0ODk3L29BQzA1Y0VCXzQwMHg0MDAucG5nIgogIGRv\
Y3VtZW50YXRpb25Vcmw6ICJodHRwOi8vd3d3LmtleWNsb2FrLm9yZy9kb2N1bWVudGF0aW9uLmh0\
bWwiCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCiAgZGVwZW5kZW5jaWVz\
OgogICAgLSAiZG9ja2VyLmlvL2pib3NzL2tleWNsb2FrLW9wZW5zaGlmdDozLjQuMy5GaW5hbCIK\
ICAgIC0gImRvY2tlci5pby9jZW50b3MvcG9zdGdyZXNxbC05Ni1jZW50b3M3OjkuNiIKICBzZXJ2\
aWNlTmFtZToga2V5Y2xvYWsKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlv\
bjogRGVwbG95IGtleWNsb2FrCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToge30KICAgIHBh\
cmFtZXRlcnM6IAogICAgLSBuYW1lOiBBRE1JTl9VU0VSTkFNRQogICAgICByZXF1aXJlZDogVHJ1\
ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEtl\
eWNsb2FrIGFkbWluIHVzZXJuYW1lCiAgICAtIG5hbWU6IEFETUlOX1BBU1NXT1JECiAgICAgIHJl\
cXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICB0aXRsZTogS2V5Y2xvYWsgYWRtaW4gcGFzc3dvcmQKICAgIC0gbmFtZTogQ1VTVE9NX1JFQUxN\
X05BTUUKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogTmFtZSBvZiB0aGUgS2V5Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRvIGN1cnJlbnQgbmFtZXNw\
YWNlKQogICAgLSBuYW1lOiBVU0VfU0hBUkVEX1NFUlZJQ0UKICAgICAgcmVxdWlyZWQ6IEZhbHNl\
CiAgICAgIHR5cGU6IGJvb2wKICAgICAgdGl0bGU6IENvbm5lY3QgdG8gYW4gZXhpc3Rpbmcgc2hh\
cmVkIHNlcnZpY2UKICAgIC0gbmFtZTogU0hBUkVEX0hPU1QKICAgICAgcmVxdWlyZWQ6IEZhbHNl\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVVJMIG9mIHRoZSBzaGFyZWQgc2Vydmlj\
ZQogICAgYmluZF9wYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBjb25zdW1lcgogICAgICByZXF1aXJl\
ZDogVHJ1ZQogICAgICB0aXRsZTogU2VydmljZSBuYW1lIG9yIENsaWVudCBJRAogICAgICB0eXBl\
OiBzdHJpbmc="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb