FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBB\
RVJPR0VBUi0xOTkzCmJpbmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOiAKICAtIG1v\
YmlsZS1zZXJ2aWNlCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBLZXljbG9hawogIGltYWdlVXJs\
OiAiaHR0cHM6Ly9wYnMudHdpbWcuY29tL3Byb2ZpbGVfaW1hZ2VzLzcwMjExOTgyMTk3OTM0NDg5\
Ny9vQUMwNWNFQl80MDB4NDAwLnBuZyIKICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cDovL3d3dy5r\
ZXljbG9hay5vcmcvZG9jdW1lbnRhdGlvbi5odG1sIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJS\
ZWQgSGF0LCBJbmMuIgogIGRlcGVuZGVuY2llczogWydQb3N0Z3Jlc3FsOjkuNSddCiAgc2Vydmlj\
ZU5hbWU6IGtleWNsb2FrCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246\
IERlcGxveSBrZXljbG9hawogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJh\
bWV0ZXJzOiAKICAgIC0gbmFtZTogQURNSU5fTkFNRQogICAgICByZXF1aXJlZDogVHJ1ZQogICAg\
ICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IEtleWNsb2Fr\
IGFkbWluIHVzZXJuYW1lCiAgICAtIG5hbWU6IEFETUlOX1BBU1NXT1JECiAgICAgIHJlcXVpcmVk\
OiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogS2V5Y2xvYWsgYWRtaW4gcGFzc3dvcmQKICAgIC0gbmFtZTogU0hBUkVEX1NFUlZJQ0UKICAg\
ICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IGJvb2wKICAgICAgdGl0bGU6IENvbm5lY3Qg\
dG8gYW4gZXhpc3Rpbmcgc2hhcmVkIHNlcnZpY2UKICAgIC0gbmFtZTogU0hBUkVEX0hPU1QKICAg\
ICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVVJMIG9m\
IHRoZSBzaGFyZWQgc2VydmljZQogICAgLSBuYW1lOiBTSEFSRURfUkVBTE0KICAgICAgcmVxdWly\
ZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogTmFtZSBvZiB0aGUgS2V5\
Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRvIGN1cnJlbnQgbmFtZXNwYWNlKQogICAgYmluZF9wYXJh\
bWV0ZXJzOgogICAgLSBuYW1lOiBzZXJ2aWNlCiAgICAgIHRpdGxlOiBUaGUgc2VydmljZSB0aGUg\
Y2xpZW50IGlzIGZvcgogICAgICB0eXBlOiBzdHJpbmcK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
