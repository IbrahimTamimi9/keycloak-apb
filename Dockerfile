FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBP\
cGVuIFNvdXJjZSBJZGVudGl0eSBhbmQgQWNjZXNzIE1hbmFnZW1lbnQKYmluZGFibGU6IFRydWUK\
YXN5bmM6IHJlcXVpcmVkCnRhZ3M6IAogIC0gbW9iaWxlLXNlcnZpY2UKICAtIG1vYmlsZS1jbGll\
bnQtZW5hYmxlZAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogS2V5Y2xvYWsKICBpbWFnZVVybDog\
Imh0dHBzOi8vcGJzLnR3aW1nLmNvbS9wcm9maWxlX2ltYWdlcy83MDIxMTk4MjE5NzkzNDQ4OTcv\
b0FDMDVjRUJfNDAweDQwMC5wbmciCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHA6Ly93d3cua2V5\
Y2xvYWsub3JnL2RvY3VtZW50YXRpb24uaHRtbCIKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVk\
IEhhdCwgSW5jLiIKICBkZXBlbmRlbmNpZXM6CiAgICAtICJkb2NrZXIuaW8vamJvc3Mva2V5Y2xv\
YWstb3BlbnNoaWZ0OjMuNC4zLkZpbmFsIgogICAgLSAiZG9ja2VyLmlvL2NlbnRvcy9wb3N0Z3Jl\
c3FsLTk2LWNlbnRvczc6OS42IgogIHNlcnZpY2VOYW1lOiBrZXljbG9hawpwbGFuczoKICAtIG5h\
bWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3kga2V5Y2xvYWsKICAgIGZyZWU6IFRy\
dWUKICAgIG1ldGFkYXRhOgogICAgICBtb2JpbGVjbGllbnRfYmluZF9wYXJhbWV0ZXJzX2RhdGE6\
CiAgICAgICAgLSAneyJuYW1lIjogIkNMSUVOVF9JRCIsICJ2YWx1ZSI6ICJtZXRhZGF0YS5uYW1l\
IiwgInR5cGUiOiAicGF0aCJ9JwogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRfVFlQRSIsICJ2\
YWx1ZSI6ICJwdWJsaWMiLCAidHlwZSI6ICJkZWZhdWx0In0nCiAgICAgIHNlcnZpY2VpbnN0YW5j\
ZV9iaW5kX3BhcmFtZXRlcnNfZGF0YToKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX0lEIiwg\
InZhbHVlIjogIm1ldGFkYXRhLm5hbWUiLCAidHlwZSI6ICJwYXRoIn0nCiAgICAgICAgLSAneyJu\
YW1lIjogIkNMSUVOVF9UWVBFIiwgInZhbHVlIjogImJlYXJlciIsICJ0eXBlIjogImRlZmF1bHQi\
fScKICAgIHBhcmFtZXRlcnM6IAogICAgLSBuYW1lOiBBRE1JTl9VU0VSTkFNRQogICAgICByZXF1\
aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
dGl0bGU6IEtleWNsb2FrIGFkbWluIHVzZXJuYW1lCiAgICAtIG5hbWU6IEFETUlOX1BBU1NXT1JE\
CiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5cGU6IHN0\
cmluZwogICAgICB0aXRsZTogS2V5Y2xvYWsgYWRtaW4gcGFzc3dvcmQKICAgIC0gbmFtZTogQ1VT\
VE9NX1JFQUxNX05BTUUKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICB0aXRsZTogTmFtZSBvZiB0aGUgS2V5Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRvIGN1cnJl\
bnQgbmFtZXNwYWNlKQogICAgLSBuYW1lOiBVU0VfU0hBUkVEX1NFUlZJQ0UKICAgICAgcmVxdWly\
ZWQ6IEZhbHNlCiAgICAgIHR5cGU6IGJvb2wKICAgICAgdGl0bGU6IENvbm5lY3QgdG8gYW4gZXhp\
c3Rpbmcgc2hhcmVkIHNlcnZpY2UKICAgIC0gbmFtZTogU0hBUkVEX0hPU1QKICAgICAgcmVxdWly\
ZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVVJMIG9mIHRoZSBzaGFy\
ZWQgc2VydmljZQogICAgYmluZF9wYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBDTElFTlRfSUQKICAg\
ICAgcmVxdWlyZWQ6IFRydWUKICAgICAgdGl0bGU6IE1vYmlsZSBjbGllbnQgSUQvU2VydmljZSBJ\
RAogICAgICB0eXBlOiBzdHJpbmcKICAgIC0gbmFtZTogQ0xJRU5UX1RZUEUKICAgICAgcmVxdWly\
ZWQ6IFRydWUKICAgICAgdGl0bGU6IEtleWNsb2FrIGNsaWVudCB0eXBlCiAgICAgIHR5cGU6IGVu\
dW0KICAgICAgZW51bTogWydiZWFyZXInLCAncHVibGljJ10KICAgICAgZGVmYXVsdDogcHVibGlj\
Cg=="


COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb