FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogVEVTVCAxIEtleWNs\
b2FrIC0gT3BlbiBTb3VyY2UgSWRlbnRpdHkgYW5kIEFjY2VzcyBNYW5hZ2VtZW50CmJpbmRhYmxl\
OiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOiAKICAtIG1vYmlsZS1zZXJ2aWNlCm1ldGFkYXRh\
OgogIGRpc3BsYXlOYW1lOiBLZXljbG9hayBoZmdoZmdoCiAgaW1hZ2VVcmw6ICJodHRwczovL3Bi\
cy50d2ltZy5jb20vcHJvZmlsZV9pbWFnZXMvNzAyMTE5ODIxOTc5MzQ0ODk3L29BQzA1Y0VCXzQw\
MHg0MDAucG5nIgogIGRvY3VtZW50YXRpb25Vcmw6ICJodHRwOi8vd3d3LmtleWNsb2FrLm9yZy9k\
b2N1bWVudGF0aW9uLmh0bWwiCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4i\
CiAgZGVwZW5kZW5jaWVzOgogICAgLSAiZG9ja2VyLmlvL2pib3NzL2tleWNsb2FrLW9wZW5zaGlm\
dDozLjQuMy5GaW5hbCIKICAgIC0gImRvY2tlci5pby9jZW50b3MvcG9zdGdyZXNxbC05Ni1jZW50\
b3M3OjkuNiIKICBzZXJ2aWNlTmFtZToga2V5Y2xvYWsKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0\
CiAgICBkZXNjcmlwdGlvbjogRGVwbG95IGtleWNsb2FrCiAgICBmcmVlOiBUcnVlCiAgICBtZXRh\
ZGF0YToge30KICAgIHBhcmFtZXRlcnM6IAogICAgLSBuYW1lOiBBRE1JTl9VU0VSTkFNRQogICAg\
ICByZXF1aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgdGl0bGU6IEtleWNsb2FrIGFkbWluIHVzZXJuYW1lCiAgICAtIG5hbWU6IEFETUlOX1BB\
U1NXT1JECiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICB0aXRsZTogS2V5Y2xvYWsgYWRtaW4gcGFzc3dvcmQKICAgIC0gbmFt\
ZTogQ1VTVE9NX1JFQUxNX05BTUUKICAgICAgcmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0\
cmluZwogICAgICB0aXRsZTogTmFtZSBvZiB0aGUgS2V5Y2xvYWsgcmVhbG0gKGRlZmF1bHRzIHRv\
IGN1cnJlbnQgbmFtZXNwYWNlKQogICAgLSBuYW1lOiBVU0VfU0hBUkVEX1NFUlZJQ0UKICAgICAg\
cmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IGJvb2wKICAgICAgdGl0bGU6IENvbm5lY3QgdG8g\
YW4gZXhpc3Rpbmcgc2hhcmVkIHNlcnZpY2UKICAgIC0gbmFtZTogU0hBUkVEX0hPU1QKICAgICAg\
cmVxdWlyZWQ6IEZhbHNlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogVVJMIG9mIHRo\
ZSBzaGFyZWQgc2VydmljZQogICAgYmluZF9wYXJhbWV0ZXJzOgogICAgLSBuYW1lOiBjb25zdW1l\
cgogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICB0aXRsZTogU2VydmljZSBuYW1lIG9yIENsaWVu\
dCBJRAogICAgICB0eXBlOiBzdHJpbmc="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb