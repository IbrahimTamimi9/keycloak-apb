FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogSWRlbnRpdHkgTWFu\
YWdlbWVudCAtIElkZW50aXR5IGFuZCBBY2Nlc3MgTWFuYWdlbWVudApiaW5kYWJsZTogVHJ1ZQph\
c3luYzogcmVxdWlyZWQKdGFnczogCiAgLSBtb2JpbGUtc2VydmljZQogIC0gbW9iaWxlLWNsaWVu\
dC1lbmFibGVkCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBJZGVudGl0eSBNYW5hZ2VtZW50CiAg\
aW1hZ2VVcmw6ICJodHRwczovL3Bicy50d2ltZy5jb20vcHJvZmlsZV9pbWFnZXMvNzAyMTE5ODIx\
OTc5MzQ0ODk3L29BQzA1Y0VCXzQwMHg0MDAucG5nIgogIGRvY3VtZW50YXRpb25Vcmw6ICJodHRw\
czovL2RvY3MuYWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9rZXljbG9hay5odG1sIgogIHByb3Zp\
ZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIgogIGRlcGVuZGVuY2llczoKICAgIC0gImRv\
Y2tlci5pby9qYm9zcy9rZXljbG9hay1vcGVuc2hpZnQ6My40LjMuRmluYWwiCiAgICAtICJkb2Nr\
ZXIuaW8vY2VudG9zL3Bvc3RncmVzcWwtOTYtY2VudG9zNzo5LjYiCiAgc2RrLWRvY3MtYW5kcm9p\
ZDogImh0dHBzOi8vZG9jcy5hZXJvZ2Vhci5vcmcvYW5kcm9pZC1zZGsvbGF0ZXN0L2dldHRpbmct\
c3RhcnRlZC9hdXRoLmh0bWwiCiAgc2RrLWRvY3MtY29yZG92YTogImh0dHBzOi8vZ2l0aHViLmNv\
bS9hZXJvZ2Vhci9hZXJvZ2Vhci1hbmRyb2lkLXNkay9ibG9iL21hc3Rlci9kb2NzL21vZHVsZXMv\
Uk9PVC9wYWdlcy9hdXRoLmFkb2MiCiAgc2RrLWRvY3MtaW9zOiAiaHR0cHM6Ly9naXRodWIuY29t\
L2Flcm9nZWFyL2Flcm9nZWFyLWFuZHJvaWQtc2RrL2Jsb2IvbWFzdGVyL2RvY3MvbW9kdWxlcy9S\
T09UL3BhZ2VzL2F1dGguYWRvYyIKICBzZGstZG9jcy14YW1hcmluOiAiaHR0cHM6Ly9naXRodWIu\
Y29tL2Flcm9nZWFyL2Flcm9nZWFyLWFuZHJvaWQtc2RrL2Jsb2IvbWFzdGVyL2RvY3MvbW9kdWxl\
cy9ST09UL3BhZ2VzL2F1dGguYWRvYyIKICBzZXJ2aWNlTmFtZToga2V5Y2xvYWsKcGxhbnM6CiAg\
LSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogRGVwbG95IGtleWNsb2FrCiAgICBmcmVl\
OiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgbW9iaWxlY2xpZW50X2JpbmRfcGFyYW1ldGVyc19k\
YXRhOgogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRfSUQiLCAidmFsdWUiOiAibWV0YWRhdGEu\
bmFtZSIsICJ0eXBlIjogInBhdGgifScKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX1RZUEUi\
LCAidmFsdWUiOiAicHVibGljIiwgInR5cGUiOiAiZGVmYXVsdCJ9JwogICAgICBzZXJ2aWNlaW5z\
dGFuY2VfYmluZF9wYXJhbWV0ZXJzX2RhdGE6CiAgICAgICAgLSAneyJuYW1lIjogIkNMSUVOVF9J\
RCIsICJ2YWx1ZSI6ICJtZXRhZGF0YS5uYW1lIiwgInR5cGUiOiAicGF0aCJ9JwogICAgICAgIC0g\
J3sibmFtZSI6ICJDTElFTlRfVFlQRSIsICJ2YWx1ZSI6ICJiZWFyZXIiLCAidHlwZSI6ICJkZWZh\
dWx0In0nCiAgICBwYXJhbWV0ZXJzOiAKICAgIC0gbmFtZTogQURNSU5fVVNFUk5BTUUKICAgICAg\
cmVxdWlyZWQ6IFRydWUKICAgICAgZGVmYXVsdDogYWRtaW4KICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgIHRpdGxlOiBLZXljbG9hayBhZG1pbiB1c2VybmFtZQogICAgLSBuYW1lOiBBRE1JTl9QQVNT\
V09SRAogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgdGl0bGU6IEtleWNsb2FrIGFkbWluIHBhc3N3b3JkCiAgICAtIG5hbWU6\
IENVU1RPTV9SRUFMTV9OQU1FCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgdGl0bGU6IE5hbWUgb2YgdGhlIEtleWNsb2FrIHJlYWxtIChkZWZhdWx0cyB0byBj\
dXJyZW50IG5hbWVzcGFjZSkKICAgIC0gbmFtZTogVVNFX1NIQVJFRF9TRVJWSUNFCiAgICAgIHJl\
cXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBib29sCiAgICAgIHRpdGxlOiBDb25uZWN0IHRvIGFu\
IGV4aXN0aW5nIHNoYXJlZCBzZXJ2aWNlCiAgICAtIG5hbWU6IFNIQVJFRF9IT1NUCiAgICAgIHJl\
cXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFVSTCBvZiB0aGUg\
c2hhcmVkIHNlcnZpY2UKICAgIGJpbmRfcGFyYW1ldGVyczoKICAgIC0gbmFtZTogQ0xJRU5UX0lE\
CiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIHRpdGxlOiBNb2JpbGUgY2xpZW50IElEL1NlcnZp\
Y2UgSUQKICAgICAgdHlwZTogc3RyaW5nCiAgICAtIG5hbWU6IENMSUVOVF9UWVBFCiAgICAgIHJl\
cXVpcmVkOiBUcnVlCiAgICAgIHRpdGxlOiBLZXljbG9hayBjbGllbnQgdHlwZQogICAgICB0eXBl\
OiBlbnVtCiAgICAgIGVudW06IFsnYmVhcmVyJywgJ3B1YmxpYyddCiAgICAgIGRlZmF1bHQ6IHB1\
YmxpYwo="


COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb